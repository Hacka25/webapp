# Project Overview
This project is designed to provide a scalable and secure infrastructure for deploying a web application using Kubernetes (k8s) on Google Cloud Platform (GCP). The project consists of several Terraform configurations, including [output.tf](output.tf), [variables.tf](variables.tf), [sql.tf](sql.tf), and [main.tf](main.tf), as well as kubernetes configuration files [k8s/deployment.yaml](k8s/deployment.yaml) and [k8s/service.yaml](k8s/service.yaml).

## Architecture
The project consists of the following components:
* A Google Cloud SQL instance named "mysql-db" running MySQL 8.0
* A Kubernetes deployment named "web-app" that runs a containerized web application
* A Kubernetes service named "web-app-service" that exposes the web application to external traffic

## Components
### Terraform Configurations
The project uses several Terraform configurations:
* [output.tf](output.tf): defines an output variable for the SQL instance connection name
* [variables.tf](variables.tf): defines variables for project ID, region, GKE cluster name, DB user, and DB password
* [sql.tf](sql.tf): creates a Google Cloud SQL instance and defines a database user and password
* [main.tf](main.tf): sets up the Terraform provider for GCP and AWS

### Kubernetes Configurations
The project uses two Kubernetes configuration files:
* [k8s/deployment.yaml](k8s/deployment.yaml): defines a deployment named "web-app" that runs a containerized web application
* [k8s/service.yaml](k8s/service.yaml): defines a service named "web-app-service" that exposes the web application to external traffic

## Data Flow
The data flow for this project is as follows:
1. The web application requests database credentials from the cloudsql-proxy container.
2. The cloudsql-proxy container retrieves the database credentials from the secret "cloudsql-instance-credentials".
3. The web application uses the retrieved database credentials to connect to the MySQL database instance.

### Mermaid Diagrams

```mermaid
flowchart TD
  A[Web Application] -->|requests DB credentials|> B(CloudSQL Proxy)
  B -->|retrieves DB credentials|> C[Secret "cloudsql-instance-credentials"]
  C -->|provides DB credentials|> A
```

### Tables

| Component | Description |
| --- | --- |
| Google Cloud SQL instance | MySQL 8.0 database instance named "mysql-db" |
| Kubernetes deployment | Containerized web application named "web-app" |
| Kubernetes service | Exposes the web application to external traffic |

### Code Snippets

```
// output.tf
output "sql_instance_connection_name" {
  value = google_sql_database_instance.mysql_instance.connection_name
}

// sql.tf
resource "google_sql_database_instance" "mysql_instance" {
  name             = "mysql-db"
  database_version = "MYSQL_8_0"
  region           = var.region

  settings {
    tier = "db-f1-micro"
    ip_configuration {
      private_network = "projects/${var.project_id}/global/networks/default"
    }
  }
}

// k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-app
spec:
  replicas: 2
  selector:
    matchLabels:
      app: web
  template:
    metadata:
      labels:
        app: web
    spec:
      containers:
      - name: app
        image: gcr.io/YOUR_PROJECT_ID/your-app:latest
        ports:
        - containerPort: 8080
        env:
        - name: DB_HOST
          value: 127.0.0.1
        - name: DB_USER
          valueFrom:
            secretKeyRef:
              name: db-credentials
              key: username
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-credentials
              key: password

      - name: cloudsql-proxy
        image: gcr.io/cloudsql-docker/gce-proxy:1.33.0
        command: ["/cloud_sql_proxy",
                  "-instances=PROJECT_ID:REGION:mysql-db=tcp:3306",
                  "-credential_file=/secrets/service_account.json"]
        volumeMounts:
        - name: sql-creds
          mountPath: /secrets
          readOnly: true

      volumes:
      - name: sql-creds
        secret:
          secretName: cloudsql-instance-credentials
```

### Source Citations

Sources:
[output.tf:1-3](), [variables.tf:1-5](), [sql.tf:1-15](), [main.tf:1-10](), [k8s/deployment.yaml:1-20](), [k8s/service.yaml:1-10]()

_Generated by P4CodexIQ

## Architecture Diagram

```mermaid
graph TD
  A[Cloud SQL] -->|Instance|> B[Google Cloud SQL Database]
  B -->|Database Instance|> C[MySQL Database]
  D[Kubernetes Deployment] -->|Container App|> E[Web Application]
  E -->|Environment Variables|> F[DB_HOST, DB_USER, DB_PASSWORD]
  G[Secrets Manager] -->|Secret|> H[db-credentials]
  I[Cloud SQL Proxy] -->|Instance Credentials|> J[cloudsql-instance-credentials]
  K[Service Account JSON] -->|Credential File|> L[/secrets/service_account.json]
  M[Google Cloud Provider] -->|Project ID|> N[Project ID]
  O[AWS Provider] -->|Account ID|> P[Account ID]
  Q[Kubernetes Service] -->|Selector|> R[app: web]
  S[Load Balancer] -->|Target Port|> T[8080]
```

_Generated by P4CodexIQ